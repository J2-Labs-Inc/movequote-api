<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CleanlyQuote Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    .loading { opacity: 0.5; pointer-events: none; }
    .tab-active { border-bottom: 2px solid #10b981; color: #10b981; }
    .stat-card { transition: transform 0.2s; }
    .stat-card:hover { transform: translateY(-2px); }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center">
    <div class="bg-gray-800 p-8 rounded-xl shadow-xl w-full max-w-md">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-emerald-400">ðŸ§¹ CleanlyQuote</h1>
        <p class="text-gray-400 mt-2">Admin Dashboard</p>
      </div>
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="block text-sm text-gray-400 mb-1">Email</label>
          <input type="email" id="loginEmail" required
            class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none">
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">Password</label>
          <input type="password" id="loginPassword" required
            class="w-full px-4 py-3 bg-gray-700 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none">
        </div>
        <button type="submit" 
          class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 rounded-lg font-semibold transition">
          Login to Admin
        </button>
        <p id="loginError" class="text-red-400 text-center hidden"></p>
      </form>
    </div>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminDashboard" class="hidden">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
      <div class="flex items-center justify-between max-w-7xl mx-auto">
        <div class="flex items-center gap-4">
          <h1 class="text-xl font-bold text-emerald-400">ðŸ§¹ CleanlyQuote Admin</h1>
        </div>
        <div class="flex items-center gap-4">
          <span id="adminEmail" class="text-gray-400 text-sm"></span>
          <button onclick="logout()" class="text-gray-400 hover:text-white">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-gray-800 border-b border-gray-700">
      <div class="max-w-7xl mx-auto px-6">
        <div class="flex gap-8">
          <button onclick="showTab('overview')" id="tab-overview" class="py-4 px-2 text-gray-400 hover:text-white tab-active">
            <i class="fas fa-chart-line mr-2"></i>Overview
          </button>
          <button onclick="showTab('users')" id="tab-users" class="py-4 px-2 text-gray-400 hover:text-white">
            <i class="fas fa-users mr-2"></i>Users
          </button>
          <button onclick="showTab('quotes')" id="tab-quotes" class="py-4 px-2 text-gray-400 hover:text-white">
            <i class="fas fa-file-invoice-dollar mr-2"></i>Quotes
          </button>
          <button onclick="showTab('revenue')" id="tab-revenue" class="py-4 px-2 text-gray-400 hover:text-white">
            <i class="fas fa-dollar-sign mr-2"></i>Revenue
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
      <!-- Overview Tab -->
      <div id="content-overview">
        <h2 class="text-2xl font-bold mb-6">Dashboard Overview</h2>
        
        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="stat-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-400 text-sm">Total Users</p>
                <p id="statTotalUsers" class="text-3xl font-bold mt-1">-</p>
              </div>
              <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                <i class="fas fa-users text-blue-400 text-xl"></i>
              </div>
            </div>
          </div>
          <div class="stat-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-400 text-sm">Total Quotes</p>
                <p id="statTotalQuotes" class="text-3xl font-bold mt-1">-</p>
              </div>
              <div class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center">
                <i class="fas fa-file-alt text-emerald-400 text-xl"></i>
              </div>
            </div>
          </div>
          <div class="stat-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-400 text-sm">Pro Users</p>
                <p id="statProUsers" class="text-3xl font-bold mt-1">-</p>
              </div>
              <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                <i class="fas fa-crown text-purple-400 text-xl"></i>
              </div>
            </div>
          </div>
          <div class="stat-card bg-gray-800 rounded-xl p-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-400 text-sm">Conversion Rate</p>
                <p id="statConversion" class="text-3xl font-bold mt-1">-</p>
              </div>
              <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                <i class="fas fa-percentage text-yellow-400 text-xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Secondary Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="bg-gray-800 rounded-xl p-6">
            <p class="text-gray-400 text-sm">Free Users</p>
            <p id="statFreeUsers" class="text-2xl font-bold mt-1">-</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-6">
            <p class="text-gray-400 text-sm">Quotes This Month</p>
            <p id="statQuotesMonth" class="text-2xl font-bold mt-1">-</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-6">
            <p class="text-gray-400 text-sm">New Users This Month</p>
            <p id="statNewUsers" class="text-2xl font-bold mt-1">-</p>
          </div>
        </div>

        <!-- Revenue Preview -->
        <div class="bg-gray-800 rounded-xl p-6">
          <h3 class="text-lg font-semibold mb-4">Revenue Snapshot</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <p class="text-gray-400 text-sm">Monthly Recurring Revenue</p>
              <p id="statMRR" class="text-2xl font-bold text-emerald-400 mt-1">$-</p>
            </div>
            <div>
              <p class="text-gray-400 text-sm">Active Subscriptions</p>
              <p id="statActiveSubs" class="text-2xl font-bold mt-1">-</p>
            </div>
            <div>
              <p class="text-gray-400 text-sm">Revenue This Month</p>
              <p id="statRevenueMonth" class="text-2xl font-bold text-emerald-400 mt-1">$-</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="content-users" class="hidden">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">Users</h2>
          <div class="flex gap-4">
            <input type="text" id="userSearch" placeholder="Search users..." 
              class="px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 focus:border-emerald-500 outline-none"
              onkeyup="debounceSearch(loadUsers)">
            <select id="userStatusFilter" onchange="loadUsers()"
              class="px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 focus:border-emerald-500 outline-none">
              <option value="all">All Users</option>
              <option value="free">Free</option>
              <option value="pro">Pro</option>
            </select>
          </div>
        </div>

        <div class="bg-gray-800 rounded-xl overflow-hidden">
          <table class="w-full">
            <thead class="bg-gray-700">
              <tr>
                <th class="px-6 py-3 text-left text-sm font-semibold">Email</th>
                <th class="px-6 py-3 text-left text-sm font-semibold">Name</th>
                <th class="px-6 py-3 text-left text-sm font-semibold">Status</th>
                <th class="px-6 py-3 text-left text-sm font-semibold">Quotes</th>
                <th class="px-6 py-3 text-left text-sm font-semibold">Created</th>
                <th class="px-6 py-3 text-left text-sm font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody" class="divide-y divide-gray-700">
              <tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Quotes Tab -->
      <div id="content-quotes" class="hidden">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">Quotes</h2>
          <div class="flex gap-4 flex-wrap">
            <input type="text" id="quoteSearch" placeholder="Search quotes..." 
              class="px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 focus:border-emerald-500 outline-none"
              onkeyup="debounceSearch(loadQuotes)">
            <select id="quoteStatusFilter" onchange="loadQuotes()"
              class="px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 focus:border-emerald-500 outline-none">
              <option value="all">All Status</option>
              <option value="draft">Draft</option>
              <option value="sent">Sent</option>
              <option value="accepted">Accepted</option>
              <option value="declined">Declined</option>
            </select>
            <button onclick="bulkDeleteSelected()" id="bulkDeleteBtn"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg hidden">
              <i class="fas fa-trash mr-2"></i>Delete Selected (<span id="selectedCount">0</span>)
            </button>
          </div>
        </div>

        <div class="bg-gray-800 rounded-xl overflow-hidden">
          <table class="w-full">
            <thead class="bg-gray-700">
              <tr>
                <th class="px-4 py-3 text-left">
                  <input type="checkbox" id="selectAllQuotes" onchange="toggleSelectAll()" 
                    class="w-4 h-4 rounded bg-gray-600">
                </th>
                <th class="px-4 py-3 text-left text-sm font-semibold">Client</th>
                <th class="px-4 py-3 text-left text-sm font-semibold">User</th>
                <th class="px-4 py-3 text-left text-sm font-semibold">Total</th>
                <th class="px-4 py-3 text-left text-sm font-semibold">Status</th>
                <th class="px-4 py-3 text-left text-sm font-semibold">Created</th>
                <th class="px-4 py-3 text-left text-sm font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody id="quotesTableBody" class="divide-y divide-gray-700">
              <tr><td colspan="7" class="px-6 py-8 text-center text-gray-400">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Revenue Tab -->
      <div id="content-revenue" class="hidden">
        <h2 class="text-2xl font-bold mb-6">Revenue & Subscriptions</h2>
        
        <!-- Revenue Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div class="bg-gray-800 rounded-xl p-6">
            <div class="flex items-center gap-3 mb-2">
              <i class="fas fa-chart-line text-emerald-400"></i>
              <p class="text-gray-400">Monthly Recurring Revenue</p>
            </div>
            <p id="revMRR" class="text-4xl font-bold text-emerald-400">$-</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-6">
            <div class="flex items-center gap-3 mb-2">
              <i class="fas fa-users text-blue-400"></i>
              <p class="text-gray-400">Active Subscriptions</p>
            </div>
            <p id="revActiveSubs" class="text-4xl font-bold">-</p>
          </div>
          <div class="bg-gray-800 rounded-xl p-6">
            <div class="flex items-center gap-3 mb-2">
              <i class="fas fa-calendar-check text-purple-400"></i>
              <p class="text-gray-400">Revenue This Month</p>
            </div>
            <p id="revThisMonth" class="text-4xl font-bold text-emerald-400">$-</p>
          </div>
        </div>

        <!-- Recent Transactions -->
        <div class="bg-gray-800 rounded-xl p-6">
          <h3 class="text-lg font-semibold mb-4">Recent Transactions</h3>
          <div id="transactionsList" class="space-y-3">
            <p class="text-gray-400">Loading...</p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
    <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
      <h3 class="text-xl font-bold mb-4">Confirm Delete</h3>
      <p id="deleteMessage" class="text-gray-400 mb-6"></p>
      <div class="flex gap-4 justify-end">
        <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg">
          Cancel
        </button>
        <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg">
          Delete
        </button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'https://api-production-9bf9.up.railway.app';
    let authToken = localStorage.getItem('adminToken');
    let currentUser = null;
    let deleteCallback = null;
    let selectedQuotes = new Set();
    let searchTimeout = null;

    // Check auth on load
    document.addEventListener('DOMContentLoaded', () => {
      if (authToken) {
        checkAuth();
      }
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      
      try {
        const res = await fetch(`${API_URL}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await res.json();
        
        if (!res.ok) {
          throw new Error(data.error || 'Login failed');
        }
        
        if (!data.user.isAdmin) {
          throw new Error('Admin access required');
        }
        
        authToken = data.token;
        currentUser = data.user;
        localStorage.setItem('adminToken', authToken);
        showDashboard();
      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.classList.remove('hidden');
      }
    });

    async function checkAuth() {
      try {
        const res = await fetch(`${API_URL}/api/admin/check`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (!res.ok) {
          throw new Error('Auth failed');
        }
        
        const data = await res.json();
        currentUser = { email: data.email, isAdmin: data.isAdmin };
        showDashboard();
      } catch (err) {
        logout();
      }
    }

    function showDashboard() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('adminDashboard').classList.remove('hidden');
      document.getElementById('adminEmail').textContent = currentUser.email;
      loadDashboard();
    }

    function logout() {
      authToken = null;
      currentUser = null;
      localStorage.removeItem('adminToken');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('adminDashboard').classList.add('hidden');
    }

    // API helper
    async function api(endpoint, options = {}) {
      const res = await fetch(`${API_URL}${endpoint}`, {
        ...options,
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Content-Type': 'application/json',
          ...options.headers
        }
      });
      
      if (res.status === 401 || res.status === 403) {
        logout();
        throw new Error('Session expired');
      }
      
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Request failed');
      return data;
    }

    // Tab navigation
    function showTab(tabName) {
      ['overview', 'users', 'quotes', 'revenue'].forEach(tab => {
        document.getElementById(`content-${tab}`).classList.toggle('hidden', tab !== tabName);
        document.getElementById(`tab-${tab}`).classList.toggle('tab-active', tab === tabName);
      });
      
      if (tabName === 'users') loadUsers();
      if (tabName === 'quotes') loadQuotes();
      if (tabName === 'revenue') loadRevenue();
    }

    // Load dashboard data
    async function loadDashboard() {
      try {
        const [stats, revenue] = await Promise.all([
          api('/api/admin/stats'),
          api('/api/admin/revenue')
        ]);
        
        document.getElementById('statTotalUsers').textContent = stats.totalUsers;
        document.getElementById('statTotalQuotes').textContent = stats.totalQuotes;
        document.getElementById('statProUsers').textContent = stats.proUsers;
        document.getElementById('statFreeUsers').textContent = stats.freeUsers;
        document.getElementById('statConversion').textContent = `${stats.conversionRate}%`;
        document.getElementById('statQuotesMonth').textContent = stats.quotesThisMonth;
        document.getElementById('statNewUsers').textContent = stats.newUsersThisMonth;
        
        document.getElementById('statMRR').textContent = `$${revenue.mrr.toFixed(2)}`;
        document.getElementById('statActiveSubs').textContent = revenue.activeSubscriptions;
        document.getElementById('statRevenueMonth').textContent = `$${revenue.revenueThisMonth.toFixed(2)}`;
      } catch (err) {
        console.error('Dashboard load error:', err);
      }
    }

    // Users
    async function loadUsers() {
      const search = document.getElementById('userSearch').value;
      const status = document.getElementById('userStatusFilter').value;
      
      try {
        const params = new URLSearchParams();
        if (search) params.set('search', search);
        if (status !== 'all') params.set('status', status);
        
        const data = await api(`/api/admin/users?${params}`);
        
        const tbody = document.getElementById('usersTableBody');
        if (data.users.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">No users found</td></tr>';
          return;
        }
        
        tbody.innerHTML = data.users.map(user => `
          <tr class="hover:bg-gray-700/50">
            <td class="px-6 py-4">
              <div>${user.email}</div>
              ${user.businessName ? `<div class="text-sm text-gray-400">${user.businessName}</div>` : ''}
            </td>
            <td class="px-6 py-4">${user.name || '-'}</td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 rounded text-xs ${user.subscriptionStatus === 'active' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-gray-600 text-gray-300'}">
                ${user.subscriptionStatus === 'active' ? 'Pro' : 'Free'}
              </span>
            </td>
            <td class="px-6 py-4">${user.quoteCount}</td>
            <td class="px-6 py-4 text-sm text-gray-400">${formatDate(user.createdAt)}</td>
            <td class="px-6 py-4">
              <button onclick="deleteUser('${user.id}', '${user.email}')" 
                class="text-red-400 hover:text-red-300">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `).join('');
      } catch (err) {
        console.error('Load users error:', err);
      }
    }

    async function deleteUser(id, email) {
      showDeleteModal(
        `Are you sure you want to delete user "${email}"? This will also delete all their quotes.`,
        async () => {
          await api(`/api/admin/users/${id}`, { method: 'DELETE' });
          loadUsers();
          loadDashboard();
        }
      );
    }

    // Quotes
    async function loadQuotes() {
      const search = document.getElementById('quoteSearch').value;
      const status = document.getElementById('quoteStatusFilter').value;
      
      try {
        const params = new URLSearchParams();
        if (search) params.set('search', search);
        if (status !== 'all') params.set('status', status);
        
        const data = await api(`/api/admin/quotes?${params}`);
        selectedQuotes.clear();
        updateBulkDeleteBtn();
        
        const tbody = document.getElementById('quotesTableBody');
        if (data.quotes.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-8 text-center text-gray-400">No quotes found</td></tr>';
          return;
        }
        
        tbody.innerHTML = data.quotes.map(quote => `
          <tr class="hover:bg-gray-700/50">
            <td class="px-4 py-4">
              <input type="checkbox" value="${quote.id}" onchange="toggleQuoteSelect('${quote.id}')"
                class="quote-checkbox w-4 h-4 rounded bg-gray-600">
            </td>
            <td class="px-4 py-4">
              <div>${quote.clientName || 'Unnamed'}</div>
              <div class="text-sm text-gray-400">${quote.clientEmail || '-'}</div>
            </td>
            <td class="px-4 py-4">
              <div class="text-sm">${quote.userEmail}</div>
            </td>
            <td class="px-4 py-4 font-semibold">$${parseFloat(quote.totalPrice || 0).toFixed(2)}</td>
            <td class="px-4 py-4">
              <span class="px-2 py-1 rounded text-xs ${getStatusClass(quote.status)}">
                ${quote.status}
              </span>
            </td>
            <td class="px-4 py-4 text-sm text-gray-400">${formatDate(quote.createdAt)}</td>
            <td class="px-4 py-4">
              <button onclick="deleteQuote('${quote.id}')" class="text-red-400 hover:text-red-300">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `).join('');
      } catch (err) {
        console.error('Load quotes error:', err);
      }
    }

    function getStatusClass(status) {
      const classes = {
        draft: 'bg-gray-600 text-gray-300',
        sent: 'bg-blue-500/20 text-blue-400',
        accepted: 'bg-emerald-500/20 text-emerald-400',
        declined: 'bg-red-500/20 text-red-400'
      };
      return classes[status] || classes.draft;
    }

    function toggleQuoteSelect(id) {
      if (selectedQuotes.has(id)) {
        selectedQuotes.delete(id);
      } else {
        selectedQuotes.add(id);
      }
      updateBulkDeleteBtn();
    }

    function toggleSelectAll() {
      const checkboxes = document.querySelectorAll('.quote-checkbox');
      const selectAll = document.getElementById('selectAllQuotes').checked;
      
      checkboxes.forEach(cb => {
        cb.checked = selectAll;
        if (selectAll) {
          selectedQuotes.add(cb.value);
        } else {
          selectedQuotes.delete(cb.value);
        }
      });
      updateBulkDeleteBtn();
    }

    function updateBulkDeleteBtn() {
      const btn = document.getElementById('bulkDeleteBtn');
      const count = document.getElementById('selectedCount');
      count.textContent = selectedQuotes.size;
      btn.classList.toggle('hidden', selectedQuotes.size === 0);
    }

    async function deleteQuote(id) {
      showDeleteModal(
        'Are you sure you want to delete this quote?',
        async () => {
          await api(`/api/admin/quotes/${id}`, { method: 'DELETE' });
          loadQuotes();
          loadDashboard();
        }
      );
    }

    async function bulkDeleteSelected() {
      const count = selectedQuotes.size;
      showDeleteModal(
        `Are you sure you want to delete ${count} quote(s)?`,
        async () => {
          await api('/api/admin/quotes/bulk-delete', {
            method: 'POST',
            body: JSON.stringify({ quoteIds: Array.from(selectedQuotes) })
          });
          loadQuotes();
          loadDashboard();
        }
      );
    }

    // Revenue
    async function loadRevenue() {
      try {
        const data = await api('/api/admin/revenue');
        
        document.getElementById('revMRR').textContent = `$${data.mrr.toFixed(2)}`;
        document.getElementById('revActiveSubs').textContent = data.activeSubscriptions;
        document.getElementById('revThisMonth').textContent = `$${data.revenueThisMonth.toFixed(2)}`;
        
        const list = document.getElementById('transactionsList');
        if (data.recentTransactions.length === 0) {
          list.innerHTML = '<p class="text-gray-400">No recent transactions</p>';
          return;
        }
        
        list.innerHTML = data.recentTransactions.map(tx => `
          <div class="flex items-center justify-between p-3 bg-gray-700/50 rounded-lg">
            <div>
              <p class="font-medium">$${tx.amount.toFixed(2)} ${tx.currency.toUpperCase()}</p>
              <p class="text-sm text-gray-400">${tx.customerEmail || 'Unknown'}</p>
            </div>
            <div class="text-right">
              <span class="px-2 py-1 rounded text-xs ${tx.status === 'succeeded' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-gray-600'}">
                ${tx.status}
              </span>
              <p class="text-sm text-gray-400 mt-1">${formatDate(tx.created)}</p>
            </div>
          </div>
        `).join('');
      } catch (err) {
        console.error('Load revenue error:', err);
        document.getElementById('transactionsList').innerHTML = 
          `<p class="text-red-400">Failed to load revenue data: ${err.message}</p>`;
      }
    }

    // Delete Modal
    function showDeleteModal(message, callback) {
      document.getElementById('deleteMessage').textContent = message;
      document.getElementById('deleteModal').classList.remove('hidden');
      deleteCallback = callback;
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.add('hidden');
      deleteCallback = null;
    }

    async function confirmDelete() {
      if (deleteCallback) {
        try {
          await deleteCallback();
        } catch (err) {
          alert('Delete failed: ' + err.message);
        }
      }
      closeDeleteModal();
    }

    // Utilities
    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleDateString('en-US', {
        month: 'short', day: 'numeric', year: 'numeric'
      });
    }

    function debounceSearch(fn) {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(fn, 300);
    }
  </script>
</body>
</html>
